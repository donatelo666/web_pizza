<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de Usuarios</title>
    <!--union con css, fuentes google, color y bootstrap-->
    <link rel="stylesheet" href="/css/usuarios.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Lemon&family=Sigmar&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
    
    <style>
      body {
        background-color: #58c06e;
      }
    </style>
  </head>

  <body>

    <!--navbar de partials-->
    <%- include('../partials/navbarAdmin') %>

    <!--tabla que itera por cada usuario (datos) y crea dos botones para editar y borrar(ruta con override)-->
    <div class="container mt-4">
      <h2 class="text-white">ğŸ‘¥ Lista de Usuarios</h2>

      <div class="card bg-dark text-white mt-3">
        <div class="card-body">
          <table class="table table-dark table-striped table-hover mb-0">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Rol</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <% usuarios.forEach(usuario => { %>
                <tr>
                  <td><%= usuario.id %></td>
                  <td><%= usuario.nombre %></td>
                  <td><%= usuario.rol %></td>
                  <td>
                    <a href="/admin/usuarios?editar=<%= usuario.id %>#formEditar" class="btn btn-sm btn-warning">âœï¸ Editar</a>
                    <form action="/admin/usuarios/<%= usuario.id %>?_method=DELETE" method="POST" class="d-inline">
                      <button type="submit" class="btn btn-sm btn-danger" onclick="return confirmarEliminacion('Â¿Eliminar este usuario?')">ğŸ—‘ï¸ Borrar</button>
                    </form>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>


      <!--construye formulario para editar, metodo override para borrar, autollenar datos con ejs
      y boton -->
      <% if (usuarioParaEditar) { %>
        <hr class="text-white" />
        <h3 class="text-white">âœï¸ Editar Usuario</h3>
        <form action="/admin/usuarios/<%= usuarioParaEditar.id %>?_method=PUT" method="POST" class="bg-dark p-3 rounded text-white" id="formEditar">
          <div class="mb-3">
            <label>Nombre</label>
            <input type="text" name="nombre" value="<%= usuarioParaEditar.nombre %>" class="form-control" required />
          </div>
          <div class="mb-3">
            <label>Rol</label>
            <select name="rol" class="form-select" required>
              <option value="admin" <%= usuarioParaEditar.rol === "admin" ? "selected" : "" %>>Admin</option>
              <option value="cliente" <%= usuarioParaEditar.rol === "cliente" ? "selected" : "" %>>Cliente</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success">ğŸ’¾ Guardar cambios</button>
        </form>
      <% } %>
    </div>

   


    <!--alert para confirmar borrado-->
    <script>
  function confirmarEliminacion() {
  const confirmado = confirm("Â¿Eliminar este usuario?");
  if (confirmado) {
    alert("âœ… Usuario eliminado con Ã©xito");
    return true; // permite que el formulario se envÃ­e
  } else {
    alert("âŒ EliminaciÃ³n cancelada");
    return false; // evita que se envÃ­e el formulario
  }
}
</script>

<!--sesion cerrada-->
<div id="notificacion" class="oculto"></div>

    <!--llamada al script cerrar-->
    <script src="/js/logout.js"></script>
    



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <% if (mensaje) { %>
  <script>
    // Mostrar alerta con el mensaje recibido desde el backend
    alert("<%= mensaje %>");

    // Si existe el formulario de ediciÃ³n, se resetea despuÃ©s del mensaje
    document.getElementById("formEditar")?.reset();
  </script>
<% } %>
  </body>
</html>
